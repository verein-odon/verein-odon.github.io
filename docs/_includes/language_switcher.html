{% comment %}
  CONFIGURATION: Define the two languages and their labels
{% endcomment %}

{% assign current_lang = page.lang | default: site.default_lang %}
{% assign current_ref = page.ref %}

{% comment %}
  Helper: Create an array containing both language codes for easy iteration.
{% endcomment %}
{% assign all_lang_codes = "en,de" | split: "," %}


<div class="header-right">
  <div class="language-switcher">

    {% for lang_code in all_lang_codes %}
      {% comment %} 1. Determine the status and label for the current button {% endcomment %}
      {% assign is_active = false %}
      {% assign label_text = "" %}
      {% assign flag_emoji = "" %}

      {% if lang_code == 'en' %}
        {% assign label_text = "English" %}
        {% assign flag_emoji = "ðŸ‡¬ðŸ‡§" %}  {% comment %} Changed from ðŸ‡ºðŸ‡¸ to ðŸ‡¬ðŸ‡§ {% endcomment %}
      {% elsif lang_code == 'de' %}
        {% assign label_text = "Deutsch" %}
        {% assign flag_emoji = "ðŸ‡¦ðŸ‡¹" %} 
      {% endif %}

      {% if lang_code == current_lang %}
        {% assign is_active = true %}
      {% endif %}

      {% comment %} 2. Find the URL for the corresponding page (same 'ref') {% endcomment %}
      {% assign target_url = nil %}
      {% for p in site.pages %}
        {% if p.lang == lang_code and p.ref == current_ref %}
          {% assign target_url = p.url %}
          {% break %}
        {% endif %}
      {% endfor %}

      {% comment %} 3. RENDER THE BUTTON/LINK {% endcomment %}

      {% if is_active %}
        <span class="lang-btn active" data-lang="{{ lang_code }}">
          <span>{{ flag_emoji }}</span>
          <span>{{ label_text }}</span>
        </span>
      {% else %}
        <a href="{{ target_url | relative_url }}" class="lang-btn" data-lang="{{ lang_code }}">
          <span>{{ flag_emoji }}</span>
          <span>{{ label_text }}</span>
        </a>
      {% endif %}

      {% comment %} Add the divider between the buttons, but not after the last one {% endcomment %}
      {% unless forloop.last %}
        <span class="lang-divider">|</span>
      {% endunless %}

    {% endfor %}

  </div>
  <button class="mobile-menu-btn" aria-label="Menu">
    <span class="hamburger"></span>
  </button>
</div>